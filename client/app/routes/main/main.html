<navbar style="position:absolute; top: 0;left:0; right:0;"></navbar>
<div class="main-page fill-height">
  <div class="command-center fill-height">
    <div class="command-sidebar-left navbar-spaced" ng-include="'app/routes/main/components/sidebar-left.html'"></div>
    <div class="command-centerbox" ng-show="$ctrl.selected.patient">
      <div class="command-centerbox-heading">
        <div class="command-centerbox-heading-left"><strong>{{$ctrl.view.main | uppercase}}</strong>&nbsp;&nbsp;|&nbsp;&nbsp;{{$ctrl.selected.patient.identity.firstName}}&nbsp;{{$ctrl.selected.patient.identity.lastName}}</div>
        <div class="command-centerbox-heading-right">
          <a href="#" ng-click="$ctrl.view.main = 'instructions'"><i class="heading-icon fa fa-list"></i></a>
          <a href="#" ng-click="$ctrl.view.main = 'messages'"><i class="heading-icon fa fa-comment"></i></a>
          <a href="#" ng-click="$ctrl.view.main = 'patient'"><i class="heading-icon fa fa-user"></i></a>
        </div>
      </div>
      <div class="command-centerbox-content">
        <div ng-if="$ctrl.view.main == 'messages'">
          <message-box messages="$ctrl.selected.messages"></message-box>
        </div>
        <div ng-if="$ctrl.view.main == 'instructions'" style="width:100%;">
          <div class="row" style="padding: 20px">
            <div class="col-md-8">
              <h3>{{$ctrl.selected.patient.identity.firstName}}&nbsp;{{$ctrl.selected.patient.identity.lastName}}</h3>
              <br>
              <span class="label label-default">Last</span> {{$ctrl.selected.patient.notifications.lastContact | fromNow}}
            </div>
            <div class="col-md-4">
              <div class="queue-container">
                <div class="pull-right">
                  <span class="label label-default" ng-show="$ctrl.selected.patient.notifications.nextContact > $ctrl.now">
                    {{$ctrl.selected.patient.notifications.nextContact | fromNow}}
                  </span>
                  <span class="label label-default" ng-hide="$ctrl.selected.patient.notifications.nextContact > $ctrl.now">
                    Next opportunity
                  </span>
                  &nbsp;&nbsp;
                  <a href="#" class="btn btn-primary btn-sm pull-right" ng-click="$ctrl.notify($ctrl.selected.patient._id)">Start Now</a>
                </div>
                <div class="queue-container-heading">
                  <strong>Upcoming</strong>
                </div>
                <div class="queue-container-content">
                  <div class="queue-list">
                    <div class="queue-list-item" ng-repeat="todo in $ctrl.selected.patient.queue">
                      {{todo.task.name}}
                    </div>
                  </div>
                  <div style="padding:10px" ng-show="$ctrl.selected.patient.queue.length == 0">
                    <i>No tasks queued.</i>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="page-divider"></div>
          <div class="instruction-list" style="width: 100%;">
            <instruction-item instruction="instruction" ng-repeat="(i, instruction) in $ctrl.selected.patient.instructions | orderBy:'adherence.score'" ng-click="$ctrl.selected.instruction = instruction"></instruction-item>
          </div>
          <div style="padding: 20px" ng-show="$ctrl.selected.patient.instructions.length == 0">
            <i>{{$ctrl.selected.patient.identity.firstName}} currently has no instructions. To add one, type in the box at the bottom of the page and then press Enter.</i>
          </div>
          <br>
        </div>
        <div ng-if="$ctrl.view.main == 'patient'" style="padding: 20px" ng-include="'app/routes/main/components/profile.html'"></div>
      </div>
      <div class="command-inputbar">
        <form ng-submit="$ctrl.addInstruction()">
          <input class="form-control" placeholder="Enter patient instruction here..." ng-model="$ctrl.instructionInput.text">
          <input type="submit" style="position: absolute; left: -9999px; width: 1px; height: 1px;" />
        </form>
      </div>
    </div>
  </div>
</div>
