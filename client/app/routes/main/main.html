<navbar style="position:absolute; top: 0;left:0; right:0;"></navbar>
<div class="main-page fill-height">
  <div class="command-center fill-height">
    <div class="command-sidebar-left navbar-spaced">
      <div class="user-searchbar">
        <form ng-submit="$ctrl.createPatient()">
          <input class="form-control" placeholder="Find patient..." ng-model="$ctrl.patientSearchQuery">
          <input type="submit" style="position: absolute; left: -9999px; width: 1px; height: 1px;" />
        </form>
      </div>
      <div class="user-list">
        <div class="user-list-item" ng-class="{'user-list-item-selected': patient._id == $ctrl.selected.patient._id}" ng-repeat="(p, patient) in $ctrl.patients" ng-click="$ctrl.selectPatient(patient._id)">
          <span class="user-name-text">{{patient.identity.firstName}}&nbsp;{{patient.identity.lastName}}</span>
          <br>
          <span style="font-size:0.8em">{{patient.identity.mobile}}</span>
        </div>
      </div>
    </div>
    <div class="command-centerbox">
      <div ng-show="$ctrl.selected.patient" style="width:100%;">
        <div class="command-centerbox-header">
          <div class="command-centerbox-header-left"><strong>{{$ctrl.view.main | uppercase}}</strong></div>
          <div class="command-centerbox-header-right">
            <a href="#" ng-click="$ctrl.view.main = 'instructions'"><i class="header-icon fa fa-list"></i></a>
            <a href="#" ng-click="$ctrl.view.main = 'messages'"><i class="header-icon fa fa-comment"></i></a></div>
        </div>
        <div ng-show="$ctrl.view.main == 'messages'">
          <message-box messages="$ctrl.selected.messages"></message-box>
        </div>
        <div ng-show="$ctrl.view.main == 'instructions'" style="width:100%;">
          <div class="instruction-list" style="width: 100%;">
            <instruction-item instruction="instruction" ng-repeat="(i, instruction) in $ctrl.selected.patient.instructions" ng-click="$ctrl.selected.instruction = instruction"></instruction-item>
          </div>
        </div>
        <div ng-show="!$ctrl.view.main == 'patient'">
          <p class="user-name-text">{{$ctrl.selected.patient.identity.firstName}}&nbsp;{{$ctrl.selected.patient.identity.lastName}}</p>
          <br>
          <br> Programs
          <br>
          <span ng-repeat="program in $ctrl.selected.patient.programs">{{program.name}}</span>
          <br>
          <br> Upcoming Tasks&nbsp;<a href="#" class="btn btn-primary btn-sm" ng-click="$ctrl.notify($ctrl.selected.patient._id)">Notify</a>
          <div class="list-group">
            <div class="list-group-item" ng-repeat="todo in $ctrl.selected.patient.queue">
              {{todo.task.name}}
            </div>
          </div>
        </div>
        <div class="command-inputbar">
          <form ng-submit="$ctrl.addInstruction()">
            <input class="form-control" placeholder="Enter patient instruction here..." ng-model="$ctrl.instructionInput.text">
            <input type="submit" style="position: absolute; left: -9999px; width: 1px; height: 1px;" />
          </form>
        </div>
      </div>
    </div>
    <div class="command-sidebar-right navbar-spaced" ng-show="$ctrl.selected.instruction">
      <div class="command-sidebar-right-content">
        <div>
          <a href="#" ng-click="$ctrl.selected.instruction = false">&times;</a>
          <br><br>
        </div>
        {{$ctrl.selected.instruction.text}}&nbsp;<a href="#"><i class="fa fa-edit"></i></a>
        <br>
        <br>
        <br> This is a
        <br>
        <select ng-model="$ctrl.selected.instruction.action.timing.type">
          <option value="once">single task</option>
          <option value="repeating">repeating action</option>
          <option value="general">general behavior change</option>
        </select>
        <br>
        <br>
        <div ng-show="$ctrl.selected.instruction.action.timing.type == 'once'">
          <strong>Timeframe</strong>
          <br>
          {{$ctrl.selected.instruction.action.timing.timeframe | timeframe}}
        </div>
        <div ng-show="$ctrl.selected.instruction.action.timing.type == 'repeating'">
          <input type="number" ng-model="$ctrl.selected.instruction.action.timing.times"> times every
          <select ng-model="$ctrl.selected.instruction.action.timing.every">
            <option value="day">day</option>
            <option value="week">week</option>
          </select>
        </div>
        <br><br>
        <div>
          <strong>Measurement Type</strong>
          <br>
          <select ng-model="$ctrl.selected.instruction.measurement.type">
            <option value="confidence">Confidence</option>
            <option value="propensity">Propensity</option>
            <option value="completedFrequency">Completed Frequency</option>
            <option value="missedFrequency">Missed Frequency</option>
            <option value="completion">Task Completion</option>
          </select>
          <br> {{$ctrl.selected.instruction.action.phrase}}&nbsp;
          <a href="#"><i class="fa fa-edit"></i></a>
        </div>
      </div>
    </div>
  </div>
</div>
